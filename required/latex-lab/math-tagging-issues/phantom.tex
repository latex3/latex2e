\DocumentMetadata{uncompress,testphase=latest,pdfversion=2.0}
\documentclass{article}
\usepackage{unicode-math}
\tagpdfsetup{math/mathml/structelem}
\begin{document}

% lots of warning about structures without parent,
% wrong output
%abc $x_1^2 \mathstrut_1^2 \vphantom{\int}_1^2  $


\makeatletter\ExplSyntaxOn
\sys_if_engine_luatex:T
{
\def\ph@nt#1{%
  \ifmmode
    \ifcase\mathstyle
      \mathph@nt\displaystyle{#1}\or
      \mathph@nt\displaystyle{#1}\or
      \mathph@nt\textstyle{#1}\or
      \mathph@nt\textstyle{#1}\or
      \mathph@nt\scriptstyle{#1}\or
      \mathph@nt\scriptstyle{#1}\or
      \mathph@nt\scriptscriptstyle{#1}\or
      \mathph@nt\scriptscriptstyle{#1}\or
    \fi 
  \else
    \expandafter\makeph@nt
  \fi}
\cs_set:Npn \mathph@nt #1 #2 {%
 %
  \setbox \z@ = \hbox {
    $
    \m@th
    #1
    {% nested phantoms should not be tagged and annotated to avoid
    % Package tagpdf Warning: structure with label 20 has already been used
    % and faulty structure
    % is suppressing annotation the right thing?
    \SuspendTagging{phantom}
    \luamml_annotate:en{core=false}{#2}}
    % save
    \luamml_save:nNn {mathphant} #1 {mphantom}
    $
  } 
  \luamml_annotate:nen {1} {
    nucleus = true,
    core = {[0] = 'mpadded',
      \ifh@\else
        width = 0,
      \fi
      \ifv@\else
        height = 0, depth = 0,
      \fi
      consume_label'mathphant',
    }
  } {
    \finph@nt
  }
   % 
}
}
\ExplSyntaxOff

abc $x_1^2 \mathstrut_1^2 \vphantom{\int}_1^2  $

abc $ \vphantom{x\mathstrut}_1^2 $ 

abc $ x\hphantom{x\mathstrut}_1^2 $ 

\end{document} 