\DocumentMetadata{ testphase = latest }
  
\documentclass{article}

\input{regression-test}


\newdimen\previousdepth
\def\test#1#2{\newpage
   \typeout{TEST: \unexpanded{#1 #2}}%
   BEFORE\hrulefill\typeout{before: \the\belowdisplayskip\space \the\belowdisplayshortskip}%
    \par#2\previousdepth\ifvmode\prevdepth\else\maxdimen\fi
    $$%
    \typeout{pre: \the\previousdepth\space (depth) \the\predisplaysize\space (displaysize)}%
    \typeout{entry: \the\belowdisplayskip\space \the\belowdisplayshortskip}%
    a=b
    \belowdisplayskip 20pt
    \belowdisplayshortskip 100pt
    \postdisplaypenalty 99
    \typeout{exit: \the\belowdisplayskip\space \the\belowdisplayshortskip}%
    \quad
    $$%
  AFTER\hrulefill\typeout{after: \the\belowdisplayskip\space \the\belowdisplayshortskip}%
  \par #1}

\showoutput

\begin{document}
\START

\parskip0pt
\parindent0pt
\abovedisplayshortskip0pt
\belowdisplayshortskip0pt
\abovedisplayskip50pt
\belowdisplayskip50pt

\test{vmode empty}{\nointerlineskip}
\test{vmode filled}{}
\test{hmode empty}{\noindent}
\test{hmode short}{AA}
\test{hmode long}{AA\hspace{0.5\textwidth}BB}



\newpage
\OMIT
\end{document}


